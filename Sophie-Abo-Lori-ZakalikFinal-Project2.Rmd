---
title: "Stats with R Final Project, Fall 2020"
authors: "Lori Zakalik and Sophie Abo"
date: "12/14/2020"
output: html_document
---

#### Package loading

```{r, echo = FALSE}
library(tidyverse)
library(knitr)
library(gridExtra)
```
```{r, echo = FALSE}
options(scipen=4)
```

***Lori Zakalik and Sophie Abo***

***December 2020***


#### Objective

Is there a significant difference in income between men and women? Are there other factors that significantly impact the income gap between men and women?


#### Introduction
This report will explore income gaps between men and women by analyzing data from the National Longitudinal Survey of Youth (NLSY) - 1997. Further information about this survey can be found on the [U.S. Bureau of Labor Statistics website](https://www.bls.gov/nls/nlsy97.htm).

Our approach to analysis of this data set was:

1. ***Variable Selection and Data Cleaning:*** In this step, we explored the NLSY 1997 data set provided by Professor C and selected variables that we were interested in exploring further based on our hypotheses about what factors could impact income gap between men and women. After we selected our variables, we examined each individually and determined the best method for transforming each variable and eliminating missing values.

2. ***Data Exploration and Statistical Analysis:*** In this step, we explored our variables to determine trends within our data. From there, we tested the significance of each variable's impact on income gap. 

3. ***Conclusion:*** After exploring the variables in depth, we built a final regression model that depicts the relationship between our significant variables and income gap between men and women. 

4. ***Discussion*** We then discuss our confidence in our methodology and final model.

#### 1. Variable Selection and Data Cleaning

We started by importing the NLSY 1997 data and looking at the column names. 

```{r, echo = FALSE}
# Import starting data
nlsy <- read_csv("http://www.andrew.cmu.edu/user/achoulde/94842/final_project/nlsy97/nlsy97_Nov2020.csv")
```

```{r, echo = FALSE}
# print out table of column names
col.names <- c("PSTRAN_GPA.01_PSTR",
    "INCARC_TOTNUM_XRND",
    "INCARC_AGE_FIRST_XRND",
    "INCARC_LENGTH_LONGEST_XRND",
    "PUBID_1997",
    "YSCH-36400_1997",
    "YSCH-37000_1997",
    "YSAQ-010_1997",
    "YSAQ-369_1997",
    "YEXP-300_1997",
    "YEXP-1500_1997",
    "YEXP-1600_1997",
    "YEXP-1800_1997",
    "YEXP-2000_1997",
    "sex",
    "KEY_BDATE_M_1997",
    "KEY_BDATE_Y_1997",
    "PC8-090_1997",
    "PC8-092_1997",
    "PC9-002_1997",
    "PC12-024_1997",
    "PC12-028_1997",
    "CV_AGE_12/31/96_1997",
    "CV_BIO_MOM_AGE_CHILD1_1997",
    "CV_BIO_MOM_AGE_YOUTH_1997",
    "CV_CITIZENSHIP_1997",
    "CV_ENROLLSTAT_1997",
    "CV_HH_NET_WORTH_P_1997",
    "CV_YTH_REL_HH_CURRENT_1997",
    "CV_MSA_AGE_12_1997",
    "CV_URBAN-RURAL_AGE_12_1997",
    "CV_SAMPLE_TYPE_1997",
    "CV_HGC_BIO_DAD_1997",
    "CV_HGC_BIO_MOM_1997",
    "CV_HGC_RES_DAD_1997",
    "CV_HGC_RES_MOM_1997",
    "race",
    "YSCH-6800_1998",
    "YSCH-7300_1998",
    "YSAQ-372B_1998",
    "YSAQ-371_2000",
    "YSAQ-282J_2002",
    "YSAQ-282Q_2002",
    "CV_HH_NET_WORTH_Y_2003",
    "CV_BA_CREDITS.01_2004",
    "YSAQ-000B_2004",
    "YSAQ-373_2004",
    "YSAQ-369_2005",
    "CV_BIO_CHILD_HH_2007",
    "YTEL-52~000001_2007",
    "YTEL-52~000002_2007",
    "YTEL-52~000003_2007",
    "YTEL-52~000004_2007",
    "CV_BIO_CHILD_HH_2009",
    "CV_COLLEGE_TYPE.01_2011",
    "CV_INCOME_FAMILY_2011",
    "CV_HH_SIZE_2011",
    "CV_HH_UNDER_18_2011",
    "CV_HH_UNDER_6_2011",
    "CV_HIGHEST_DEGREE_1112_2011",
    "CV_BIO_CHILD_HH_2011",
    "YSCH-3112_2011",
    "YSAQ-000A000001_2011",
    "YSAQ-000A000002_2011",
    "YSAQ-000B_2011",
    "YSAQ-360C_2011",
    "YSAQ-364D_2011",
    "YSAQ-371_2011",
    "YSAQ-372CC_2011",
    "YSAQ-373_2011",
    "YSAQ-374_2011",
    "YEMP_INDCODE-2002.01_2011",
    "CV_BIO_CHILD_HH_2015",
    "YEMP_INDCODE-2002.01_2017",
    "YEMP_OCCODE-2002.01_2017",
    "CV_MARSTAT_COLLAPSED_2017",
    "YINC-1400_2017",
    "income",
    "YINC-1800_2017",
    "YINC-2400_2017",
    "YINC-2600_2017",
    "YINC-2700_2017",
    "CVC_YTH_REL_HH_AGE6_YCHR_XRND",
    "CVC_SAT_MATH_SCORE_2007_XRND",
    "CVC_SAT_VERBAL_SCORE_2007_XRND",
    "CVC_ACT_SCORE_2007_XRND",
    "CVC_HH_NET_WORTH_20_XRND",
    "CVC_HH_NET_WORTH_25_XRND",
    "CVC_ASSETS_FINANCIAL_25_XRND",
    "CVC_ASSETS_DEBTS_20_XRND",
    "CVC_HH_NET_WORTH_30_XRND",
    "CVC_HOUSE_VALUE_30_XRND",
    "CVC_HOUSE_TYPE_30_XRND",
    "CVC_ASSETS_FINANCIAL_30_XRND",
    "CVC_ASSETS_DEBTS_30_XRND")
colnames(nlsy) <- col.names
col.names
```

We then extracted a subset of the data with our variables of interest. The column names of this subset are shown below. As you can see these given column names are difficult to interpret. 

```{r, echo = FALSE}
income.sex.data <- nlsy %>% 
  select('sex', 'income', 'race', 'INCARC_TOTNUM_XRND', 'CV_BIO_MOM_AGE_YOUTH_1997', 'PC9-002_1997', 'CV_HH_NET_WORTH_P_1997', 'CV_URBAN-RURAL_AGE_12_1997', 'CV_BIO_CHILD_HH_2007', 'CV_HIGHEST_DEGREE_1112_2011', 'CVC_ASSETS_DEBTS_20_XRND')
subset.col.names <- colnames(income.sex.data)
subset.col.names
#discuss renaming columns and recoding numeric data as factor when appropriate (go through each variable and explain recode and how to handle missing values)
```


**sex**, **income**, and **race** already had descriptive names. We renamed the other variables to make them equally descriptive. Below is a summary of the other variables.

1. **INCARC_TOTNUM_XRND**: Total number of incarcerations reported by the respondent. We renamed this variable to **tot.incarc**.

2. **CV_BIO_MOM_AGE_YOUTH_1997**: Biological mother's age when respondent was born. We renamed this variable to **mom.age.at.birth**.

3. **PC9-002_1997**: Indication of any physical, emotional, or mental limitations as reported by respondent. We renamed this variable to **phy.emo.issue**.

4. **CV_HH_NET_WORTH_P_1997**: Net worth of the household according to respondent's parent. We renamed this variable to **house.net.worth**. 

5. **CV_URBAN-RURAL_AGE_12_1997**: Respondent's local (urban or rural) at age 12 as reported by the respondent's parent. We renamed this variable to **urban.rural**. 

6. **CV_BIO_CHILD_HH_2007**: Number of biological children born and residing in the respondent's household as of 2007. We renamed this variable to **bio.children.2007**. 

7. **CV_HIGHEST_DEGREE_1112_2011**: Highest degree received by the respondent prior to the start of the 2011-2012 school year. We renamed this variable to **high.degree.earned**. 

8. **CVC_ASSETS_DEBTS_20_XRND**: Amount of financial debt owed by respondent at age 20. We renamed this variable to **debt.at.20**.

Our renamed variables can be seen below.
```{r, echo = FALSE}
colnames(income.sex.data)<- c('sex', 'income', 'race', 'tot.incarc', 'mom.age.at.birth', 'phy.emo.issue', 'house.net.worth', 'urban.rural', 'bio.children.2007', 'high.degree.earned', 'debt.at.20')

subset.col.names.2 <- colnames(income.sex.data)
subset.col.names.2
```

The table below shows the first few rows of the table with the variables renamed. 

```{r, echo = FALSE}
head(income.sex.data)
```

```{r, echo = FALSE}
income.sex.data <- mutate(income.sex.data, sex = recode_factor(sex, `1` = 'Male', `2` = 'Female'))

income.sex.data$income[income.sex.data$income < 0] <- NA

income.sex.data <- mutate(income.sex.data, race = recode_factor(race, `4` = 'Other', `1` = 'Black', `2` = 'Hispanic', `3` = 'Mixed Race'))

income.sex.data$tot.incarc[income.sex.data$tot.incarc < 0] <- NA

income.sex.data$mom.age.at.birth[income.sex.data$mom.age.at.birth < 0] <- NA

income.sex.data <- mutate(income.sex.data, phy.emo.issue = recode_factor(phy.emo.issue, `0` = 'No', `1` = 'Yes', `-4` = 'Valid Skip'))

income.sex.data$house.net.worth[income.sex.data$house.net.worth < 0] <- NA

income.sex.data <- mutate(income.sex.data, urban.rural = recode_factor(urban.rural, `1` = 'Urban', `0` = 'Rural', `2` = 'Unknown', `-3` = 'Skipped', `-4` = 'Skipped'))

income.sex.data <- mutate(income.sex.data, bio.children.2007 = recode(bio.children.2007, `0` = 0, `1` = 1, `2` = 2, `3` = 3, `4` = 4, `5` = 5, `6` = 6, `7` = 7, `8` = 8, `-4` = 0)) # -4(valid skip) is converted to zero children

income.sex.data <- mutate(income.sex.data, bio.children.2007 = na_if(bio.children.2007, -5))

income.sex.data <- mutate(income.sex.data, bio.children.2007 = na_if(bio.children.2007, -3))

income.sex.data <- mutate(income.sex.data, high.degree.earned = recode_factor(high.degree.earned, `0` = 'None', `1` = 'GED', `2` = 'HS Diploma', `3` = 'Assoc Degree', `4` = 'Bach Degree', `5` = 'Master Degree', `6` = 'PhD', `7` = 'Prof Degree', `-3` = 'Missing', `-5` = 'Missing'))

income.sex.data$debt.at.20[income.sex.data$debt.at.20 < 0] <- NA
```
We then examined the values in each variable to determine how to transform the data into usable data. For each variable we looked at what data type each variable required. We also looked at reported missing or skipped responses for each variable and determined how to recode them. 

1. **income**: There were 3893 missing or skipped responses for this variable. Because the variable is numeric, we were unable to recode this values as "Missing" or "Skipped." Further, assigning these responses as 0 did not make sense in this context, because this would have skewed our data. As a result, we assigned any missing or skipped value as "NA." We also noted that the top 2% of responses were topcoded as an average of those responses. 

2. **sex**: There were no missed or skipped responses for this variable. We recoded **sex** as a factor variable and set the levels to 1 as "Male" and 2 as "Female." 

3. **race**: There were no missed or skipped response for this variable. We recoded **race** as a factor variable and set the levels to 1 as "Black," 2 as "Hispanic," 3 as "Mixed-Race," and 4 as "Other." We then set "Other" as our base variable. 

4. **tot.incarc**: There were 21 skipped responses for this variable. Since this is a numeric variable and the 21 skipped responses were a small percentage of the incarceration data, we choose to recode these responses as "NA." All other responses were left as reported. 

5. **mom.age.at.birth**: There were 608 skipped responses for this variable. Since this is a numeric variable, we choose to recode the skipped responses as "NA." All other responses were left as reported. 

6. **phy.emo.issue**: There were 1100 missed or skipped responses for this variable. 1092 of these responses were -4 which corresponded with "valid skip." Because these "valid skips" were a large enough percentage of the data, we were curious to see if being granted a "valid skip" ultimately impacted income gap between men and women. We recoded **phy.emo.issue** as a factor variable and set the levels to 0 as "No," 1 as "Yes," and -4 as "Valid Skip." The 8 missed responses were recoded as "NA."

7. **house.net.worth**: There were 2365 skipped responses for this variable. Since this is a numeric variable, we choose to recode the skipped responses as "NA." All other responses were left as reported.  We also noted that net values reported above $600,000 were topcoded to a value of $600,000. 

8. **urban.rural**: There were 2198 skipped responses for this variable. Because these "skips" were a large enough percentage of the data, we were curious to see if not reporting location ultimately impacted income gap between men and women. We recoded **urban.rural** as a factor variable and set the levels to 0 as "Rural," 1 as "Urban," 2 as "Unknown," and -3 and -4 as "Skipped." 

9. **bio.children.2007**: There were 1569 missing or invalid skipped responses for this variable. There were 4303 valid skips for this variable. Respondents without any biological children were automatically assigned a "valid skip." Since this is a numeric variable, we recoded the "Valid Skips" as 0 and missing or invalid skips as "NA." All other responses were left as reported. 

10. **high.degree.earned**: There were 1621 missing or skipped responses for this variable. Because this was a large enough percentage of the data, we were curious to see if not reporting a degree ultimately impacted income gap between men and women. We recoded **high.degree.earned** as a factor variable and set the levels to: 0 to "None," 1 to "GED," 2 to "HS Diploma," 3 to "Assoc Degree," 4 to "Bach Degree," 5 to "Master Degree," 6 to "PhD," 7 to "Prof Degree," -3 to "Missing," and -5 to "Missing."

11. **debt.at.20**: There were 609 missing responses for this variable. Since this is a numeric variable, we choose to recode the skipped responses as "NA." All other responses were left as reported. We also noted that values reported above $370,000 were topcoded to a value of $370,000. 

We then omitted all the rows with "NA" values from our data set to move forward with our statistical analysis. After doing this, the number of rows decreased from 8984 to 3138. The table below shows the first few rows of our cleaned data set. 

```{r, echo = FALSE}
income.sex.data.clean <- na.omit(income.sex.data)
head(income.sex.data.clean)
#total observations in original data set vs. clean data set
```

#### 2. Data Exploration and Statistical Analysis

We started our data exploration phase by exploring the response variable **income**. Based on the histogram below, we can see that income is right skewed. The topcoding is represented by the outlier data between $225,000 and $250,000. 

```{r, echo = FALSE}
hist.1 <- ggplot(income.sex.data.clean, aes(x=income)) + geom_histogram(fill = I('steelblue')) +
labs(title = 'Count of Respondents by Income', x = 'Income', y = 'Count')
hist.1

income.subset <- filter(income.sex.data.clean, (income < 149000)) 

```

To understand the effect that topcoding had on the income variable, we created a histogram without the topcoded income responses. As you can see from the histogram below, the non-topcoded data looks more normal, while still skewing right. We also calculated the mean income for the data with and without the topcoded responses. The mean with the topcoded responses is  $`r round(mean(income.sex.data.clean$income), 2)`. The mean without the topcoded responses is $`r round(mean(income.subset$income), 2)`. The topcoded responses increases the mean by $`r round(mean(income.sex.data.clean$income), 2)-round(mean(income.subset$income), 2)`. We considered this further when building and analyzing our regression models. 

```{r, echo = FALSE}
hist.2 <- ggplot(income.subset, aes(x=income)) + geom_histogram(fill = I('steelblue')) +
labs(title = 'Count of Respondents by Income without Topcoding', x = 'Income', y = 'Count')
hist.2
```

We started our analysis of the **sex** variable by looking at the difference in mean income between men and women. From the boxplot, we noted that men have a higher 1st quartile, mean, and 3rd quartile income as compared to women. There appears to be an association between sex and mean income. We will explore this relationship further below. 

```{r, echo = FALSE}
sex.box.plot <- ggplot(income.sex.data.clean, aes(x = sex, y = income, fill = sex)) + geom_boxplot() + labs(title = "Sex and Income", x = "Sex", y = "Income") + theme(legend.position = "none")
sex.box.plot
```

```{r, echo = FALSE}
sex.table <- income.sex.data.clean %>% 
  group_by(sex) %>% 
  summarize(num.obs = n(), mean.income = round(mean(income, na.rm = TRUE), 2), sd.income = round(sd(income, na.rm = TRUE), 0), se.income =   round(sd(income, na.rm = TRUE) / sqrt(num.obs), 2))
```

The table below illustrates that approximately half the observations in the data set are men and half are women. Men have a mean income of $`r sex.table$mean.income[1]`, and women have a mean income of $`r sex.table$mean.income[2]`. The average income gap between men and women is $`r sex.table$mean.income[1]-sex.table$mean.income[2]`. Due to the large standard error associated with this sample, $`r sex.table$se.income[1]` for men and $`r sex.table$se.income[2]` for women, we completed further statistical analysis to prove there is a statistically significant difference in income between men and women.

```{r, echo = FALSE}
sex.table

income.sex.t.test <- t.test(income.sex.data.clean$income ~ income.sex.data.clean$sex)
```

To evaluate the statistical significance of our observations above, we ran a t.test() on **income** and **sex**. The results of the t.test() confirmed that there is a highly significant difference in average income between men and women at the .05 level with a p-value of `r round(income.sex.t.test$p.value, 4)`. Since the p-value is so small, when rounding to 4 digits it appears as 0.  

```{r, echo = FALSE}
income.sex.t.test
```

After confirming that sex has a significant impact on average income, we decided to create a regression model with all of our variables and decide which relationships we wanted to explore in depth. From this regression model without any interaction terms, we identified 2 variables that were not significant at the .05 level (**phy.emo.issues** and **bio.children.2007**).


```{r, echo = FALSE}
income.sex.lm <- lm(income ~ ., data = income.sex.data.clean)
income.sex.lm.kable <- kable(coef(summary(income.sex.lm)), digits = c(0, 0, 2, 4))
income.sex.lm.kable
```

We updated the above regression model with interaction terms between sex and each variable to confirm which variables were insignificant and which we wanted to further explore. **phy.emo.issues** was the only variable that was insignificant at the .05 level in both regression models, so we decided to not explore this variable further in our analysis. 

```{r, echo = FALSE}
full.model.interact.lm <- update(income.sex.lm, . ~ . + sex*race + sex*tot.incarc + sex*mom.age.at.birth + sex*phy.emo.issue + sex*house.net.worth + sex*urban.rural + sex*bio.children.2007 + sex*high.degree.earned + sex*debt.at.20)

full.model.interact.lm.kable <- kable(coef(summary(full.model.interact.lm)), digits = c(0, 0, 2, 4))
full.model.interact.lm.kable
```

Before we moved forward with our exploration, we ran a pairs() test to confirm that the variables were not co-linear and found that all of our variables had correlations coefficients of .31 or less. Therefore we concluded that the variables in our analysis were not co-linear.

```{r, echo = FALSE}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- abs(cor(x, y))
    txt <- format(c(r, 0.123456789), digits = digits)[1]
    txt <- paste0(prefix, txt)
    if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = pmax(1, cex.cor * r))
}

pairs.1 <- pairs(income.sex.data.clean[, c('income', 'sex', 'race', 'tot.incarc', 'mom.age.at.birth', 'phy.emo.issue', 'house.net.worth', 'urban.rural', 'bio.children.2007', 'high.degree.earned', 'debt.at.20')], lower.panel = panel.cor)
pairs.1

```


```{r, echo = FALSE}
income.sex.race <- income.sex.data.clean %>% 
  group_by(race) %>% 
  summarize(mean.male.income = round(mean(income[sex == 'Male']), 2), 
            mean.female.income = round(mean(income[sex == 'Female']), 2), 
            income.gap = round(mean(income[sex == 'Male']) -
              mean(income[sex == 'Female']), 2))

income.sex.race.kable <- income.sex.race %>% 
  kable(format = 'markdown', digits = 2)
```

We then wanted to explore how **race** affects the income gap between men and women. We found that the income gap was greatest for the race "Other" with a gap of $`r income.sex.race$income.gap[1]`. We found that the income gap was smallest for the race "Black" with a gap of $`r income.sex.race$income.gap[2]`.

```{r}
income.sex.race.kable
```

```{r, echo = FALSE}
race.numbers <- income.sex.data.clean %>%
  group_by(race) %>%
  summarize(num.obs = n())

```

To confirm that our observations above are statistically significant, we then decided to create a bar graph that incorporated the results of a t.test() on **income** and **sex** grouped by race. The bar graph includes error bars derived from the t.test() confidence intervals. The bars are color coded to indicate significance at the .05 level. 

From the bar graph we concluded that there is a significant difference in income between men and women within each race, because the error bars do not overlap 0, except for the race "Mixed Race." We also concluded that men earn more than women, because the bars are all positive. We were surprised to find that there is a race category where income gap is not statistically significant. This could be attributed to the small number of "Mixed Race" observations. In our data subset, there were only `r race.numbers$num.obs[4]` "Mixed Race" observations reported.

```{r, echo = FALSE}
race.income.gap.data <- income.sex.data.clean %>% 
  group_by(race) %>% 
  summarize(income.gap = round(mean(income[sex == 'Male']) -
              mean(income[sex == 'Female']), 2),
            lower = t.test(income ~ sex)$conf.int[1],
            upper = t.test(income ~ sex)$conf.int[2],
            is.significant = as.numeric(t.test(income ~ sex)$p.value < 0.05))

race.income.gap.data.kable <- race.income.gap.data %>% 
  kable(format = 'markdown', digits = 2)

race.income.gap.data <- mutate(race.income.gap.data, race = reorder(race, income.gap))

race.income.gap.data.plot <- ggplot(data = race.income.gap.data, aes(x = race, y = income.gap, fill =  as.factor(is.significant))) +
  geom_bar(stat = 'identity') +
  xlab('Race') +
  ylab('Income Gap ($)') +
  ggtitle('Income gap between men and women, by race') +
  guides(fill = FALSE) +
  geom_errorbar(aes(ymax = upper, ymin = lower), width = 0.1, size = 1) +
  theme(text = element_text(size = 12)) +
  guides(fill = guide_legend(title = " Statistically Significant"))

race.income.gap.data.plot
```

We then created a simple regression model between **income**, **sex**, **race**. From the output below we found that "Mixed Race" does not have a significant impact on income.

```{r, echo = FALSE}
income.sex.race.lm <- lm(income ~ sex + race, data = income.sex.data.clean)

income.sex.race.lm.kable <- kable(coef(summary(income.sex.race.lm)), digits = c(0, 0, 2, 4))
income.sex.race.lm.kable


income.sex.race.lm.interact <- update(income.sex.race.lm, . ~ . + race*sex)
```

To further explore the impact of **race** on income gap, we updated our regression model to include an interaction term between **sex** and **race**. We interpreted these results as such: The income gap between "Black" men and "Black" women is $`r round(income.sex.race.lm.interact$coef[6], 2)` less than the income gap between "Other" race men and "Other" women. 

```{r, echo = FALSE}
income.sex.race.lm.interact.kable <- kable(coef(summary(income.sex.race.lm.interact)), digits = c(0, 0, 2, 4))
income.sex.race.lm.interact.kable
```

Using an anova test, we confirmed that the race-specific intercepts capture significantly more variation in income than the single intercept model at a significance level of .05, with a P-value of .00011. 

```{r, echo = FALSE}
anova.1 <- anova(update(income.sex.race.lm.interact, . ~ . - race:sex), income.sex.race.lm.interact)
anova.1
```

We then used the plot() function to produce diagnostic plots for the **income**, **sex**, and **race** regression model with the race and sex interaction term.

***1. Residuals vs. Fitted:*** The plot looks almost linear, with an almost horizontal red line. The slight downward slope can possibly be attributed to the topcoded income values in our data set. 

***2. Normal Q-Q:*** The data looks relatively normally distributed, with a heavy upper tail that again can mostly be attributed to topcoded income values in our data set.

***3. Scale-Location:*** There is a slight upward trend of the red line in this plot, which could represent increasing variance.

***4. Residuals vs. Leverage:*** There are no obvious outliers. 


```{r, echo = FALSE}
par(mfrow = c(2,2), cex = 1)
income.sex.race.lm.interact.plot <- plot(income.sex.race.lm.interact)
income.sex.race.lm.interact.plot
```


```{r, echo = FALSE}
income.sex.edu <- income.sex.data.clean %>% 
  group_by(high.degree.earned) %>% 
  summarize(mean.male.income = round(mean(income[sex == 'Male']), 2), 
            mean.female.income = round(mean(income[sex == 'Female']), 2), 
            income.gap = round(mean(income[sex == 'Male']) -
              mean(income[sex == 'Female']), 2))

kable.1 <-income.sex.edu %>% 
  kable(format = 'markdown', digits = 2)
```

After looking at **race**, we then wanted to explore how **high.degree.earned** affects the income gap between men and women. We found that the income gap was greatest for the people who have a professional degree, with a gap of $`r income.sex.edu$income.gap[8]`0. We found that the income gap was smallest for those who did not answer the question, recoded as "Missing", with a gap of $`r income.sex.edu$income.gap[9]`.

```{r, echo = FALSE}
kable.1 
```

```{r, echo = FALSE}
edu.income.gap <- income.sex.data.clean %>% 
 group_by(high.degree.earned) %>%
 summarize(income.gap = mean(income[sex == 'Male']) -
              mean(income[sex == 'Female']),
              lower = t.test(income ~ sex)$conf.int[1],
              upper = t.test(income ~ sex)$conf.int[2],
              is.significant = as.numeric(t.test(income ~ sex)$p.value < 0.05))
```

```{r, echo = FALSE}
edu.income.gap.bar <- ggplot(data = edu.income.gap, aes(x = high.degree.earned, y = income.gap,
                            fill = as.factor(is.significant))) +
  geom_bar(stat = "identity") +
  xlab("Highest Degree Received") + 
  ylab("Income gap($)") +
  ggtitle("Income gap between men and women, by degree") + 
  geom_errorbar(aes(ymax = upper, ymin = lower), width = 0.1, size = 1) +
  theme(text = element_text(size=12)) +
  theme(axis.text.x=element_text(angle =- 90, vjust = 0.5)) + 
  guides(fill = guide_legend(title = " Statistically Significant"))
```

To confirm that our observations above are statistically significant, we then decided to create a bar graph that incorporated the results of a t.test() on **income** and **sex** grouped by **high.degree.earned**. The bar graph includes error bars derived from the t.test() confidence intervals. The bars are color coded to indicate significance at the .05 level. 

From the bar graph we concluded that there is a significant difference in income between men and women from "None" through "Master Degree," because the error bars do not overlap 0. For "PhD," "Prof Degree," and "Missing" the income gap is not significant. Given our above analysis showing that "PhD" had the largest income gap, it is important to note that those results are not significant. 

```{r, echo = FALSE}
edu.income.gap.bar
```

We then created a simple regression model between **income**, **sex**, **high.degree.earned**. From the output below we found that "GED" does not have a significant impact on income, based on the baseline "None" or no degree.

```{r, echo = FALSE}
income.sex.edu.lm <- lm(income ~ sex + high.degree.earned, data = income.sex.data.clean)

kable(coef(summary(income.sex.edu.lm)), digits = c(0, 0, 2, 4))
```

```{r, echo = FALSE}
income.sex.edu.lm.interact <- update(income.sex.edu.lm, . ~ . + high.degree.earned*sex)
kable.2 <- kable(coef(summary(income.sex.edu.lm.interact)), digits = c(0, 0, 2, 4))
```

To further explore the impact of **high.degree.earned** on income gap, we updated our regression model to include an interaction term between **sex** and **high.degree.earned**. None of the interaction terms in this regression model were statistically significant at the .05 level, aside from "Missing" which was the category of respondents who did not answer the question.  

```{r, echo = FALSE}
kable.2
```

Since none of the above interaction terms were significant, we decided to run an anova test to see if the high.degree.earned-specific intercepts captured significantly more variation in income than the single intercept model at a significance level of .05. We were surprised to see that despite the insignificant interaction terms in the previous regression model, the anova test results claimed significance with a p-value of .00026.

```{r, echo = FALSE}
anova.3 <- anova(update(income.sex.edu.lm.interact, . ~ . - high.degree.earned:sex), income.sex.edu.lm.interact)
anova.3
```


We then used the plot() function to produce diagnostic plots for the **income**, **sex**, and **high.degree.earned** regression model with the high.degree.earned and sex interaction term.

***1. Residuals vs. Fitted:*** The plot looks almost linear, with a slight dip in the middle of the horizontal red line. If we were to explore further, we could try squaring the income variable to see if that improves model fit.

***2. Normal Q-Q:*** The data looks relatively normally distributed, with a heavy upper tail that again can mostly be attributed to topcoded income values in our data set.

***3. Scale-Location:*** There is an upward trend of the red line in this plot, which could represent increasing variance.

***4. Residuals vs. Leverage:*** There are no obvious outliers. 

```{r, echo = FALSE}
par(mfrow = c(2,2), cex = 1)
income.sex.edu.lm.interact.plot <- plot(income.sex.edu.lm.interact)
income.sex.edu.lm.interact.plot
```


```{r, echo = FALSE}
income.sex.location <- income.sex.data.clean %>% 
  group_by(urban.rural) %>% 
  summarize(mean.male.income = round(mean(income[sex == 'Male']), 2), 
            mean.female.income = round(mean(income[sex == 'Female']), 2), 
            income.gap = round(mean(income[sex == 'Male']) -
              mean(income[sex == 'Female']), 2))

kable.location <- income.sex.location %>% 
  kable(format = 'markdown', digits = 2)
```

After looking at **high.degree.earned**, we then wanted to explore how **urban.rural** affects the income gap between men and women. We found that the income gap was greatest for the people who responded with "Unknown", with a gap of $`r income.sex.location$income.gap[3]`. We found that the income gap was smallest for those who lived in rural areas, with a gap of $`r income.sex.location$income.gap[2]`.

```{r, echo = FALSE}
kable.location
```

To confirm that our observations above are statistically significant, we then decided to create a bar graph that incorporated the results of a t.test() on **income** and **sex** grouped by **urban.rural**. The bar graph includes error bars derived from the t.test() confidence intervals. The bars are color coded to indicate significance at the .05 level. 

From the bar graph we concluded that there is a significant difference in income between men and women within each location as well as those who skipped this question, because the error bars do not overlap 0. However, the income gap for those who responded with "Unknown" is insignificant. Given our above analysis showing that "Unknown" had the largest income gap, it is important to note that the results are not significant. 

```{r, echo = FALSE}
location.income.gap <- income.sex.data.clean %>% 
  group_by(urban.rural) %>% 
  summarize(income.gap = round(mean(income[sex == 'Male']) -
              mean(income[sex == 'Female']), 2),
            lower = t.test(income ~ sex)$conf.int[1],
            upper = t.test(income ~ sex)$conf.int[2],
            is.significant = as.numeric(t.test(income ~ sex)$p.value < 0.05))

location.income.gap <- mutate(location.income.gap, urban.rural = reorder(urban.rural, income.gap))

bar.graph.location <- ggplot(data = location.income.gap, aes(x = urban.rural, y = income.gap, fill = is.significant)) +
  geom_bar(stat = 'identity') +
  xlab('Location') +
  ylab('Income Gap ($)') +
  ggtitle('Income gap between men and women, by location') +
  guides(fill = FALSE) +
  geom_errorbar(aes(ymax = upper, ymin = lower), width = 0.1, size = 1) +
  theme(text = element_text(size = 12))

bar.graph.location
```


We then created a simple regression model between **income**, **sex**, **urban.rural**. From the output below we found that "Unknown" and "Rural" do not have a significant impact on income. 

```{r, echo = FALSE}
income.sex.loc.lm <- lm(income ~ sex + urban.rural, data = income.sex.data.clean)
kable.location <- kable(coef(summary(income.sex.loc.lm)), digits = c(0, 0, 2, 4))
kable.location
```

To further explore the impact of **urban.rural** on income gap, we updated our regression model to include an interaction term between **sex** and **urban.rural**. None of the interaction terms were significant. 

```{r, echo = FALSE}
income.sex.loc.lm.interact <- update(income.sex.loc.lm, . ~ . + urban.rural*sex)
kable.location.2 <- kable(coef(summary(income.sex.loc.lm.interact)), digits = c(0, 0, 2, 4))
kable.location.2
```

Using an anova test, we confirmed that the location-specific intercepts do not capture significantly more variation in income than the single intercept model at a significance level of .05, with a P-value of .7164.

```{r, echo = FALSE}
anova.location <- anova(update(income.sex.loc.lm.interact, . ~ . - urban.rural:sex), income.sex.loc.lm.interact)
anova.location
```

```{r, echo = FALSE}
income.sex.incarc <- income.sex.data.clean %>% 
  group_by(tot.incarc) %>% 
  summarize(mean.male.income = round(mean(income[sex == 'Male']), 2), 
            mean.female.income = round(mean(income[sex == 'Female']), 2), 
            income.gap = round(mean(income[sex == 'Male']) -
              mean(income[sex == 'Female']), 2))

kable.incarc <- income.sex.incarc %>% 
  kable(format = 'markdown', digits = 2)
```

After looking at **urban.rural**, we then wanted to explore how **tot.incarc** affects the income gap between men and women. We found that the income gap was greatest for the people who served 3 sentences in prison, with a gap of $`r income.sex.incarc$income.gap[4]`. We found that the income gap did not exist for those who served 5 or more sentences, because none of the female respondents served that many prison sentences. Because we did not have income gap data above 5 sentences, we did not conduct a t.test() and make a bar graph with confidence intervals for this variable. 

```{r, echo = FALSE}
kable.incarc
```

```{r, echo = FALSE}
income.sex.incarc.lm <- lm(income ~ sex + tot.incarc, data = income.sex.data.clean)
```

We then created a simple regression model between **income**, **sex**, **tot.incarc**. From the output below we found that incarceration has a significant impact on income at the .05 significance level. 

```{r, echo = FALSE}
kable.incarc.lm <- kable(coef(summary(income.sex.incarc.lm)), digits = c(0, 0, 2, 4))
kable.incarc.lm
```

To further explore the impact of **tot.incarc** on income gap, we updated our regression model to include an interaction term between **sex** and **tot.incarc**. The interaction between sex and incarceration does not have a significant impact on income at the .05 significance level. 

```{r, echo = FALSE}
income.sex.incarc.lm.interact <- update(income.sex.incarc.lm, . ~ . + tot.incarc*sex)
kable.incarc.2 <- kable(coef(summary(income.sex.incarc.lm.interact)), digits = c(0, 0, 2, 4))
kable.incarc.2
```

In the graph on the left below, you can see that there is a slight gradual increase in income gap between men and women under 4 incarcerations. After that, women's income drops below 0 because we have no data on women serving more than 4 prison sentences. 
```{r, echo = FALSE}
intercepts <- c(coef(income.sex.incarc.lm)["(Intercept)"],
                coef(income.sex.incarc.lm)["(Intercept)"] + coef(income.sex.incarc.lm)["sexFemale"])

income.sex.incarc.slopes <- data.frame(intercepts = intercepts,
                       slopes = rep(coef(income.sex.incarc.lm)["tot.incarc"], 2),
                       sex = levels(income.sex.data.clean$sex))

plot.interact <- qplot(x = tot.incarc, y = income, color = sex, data = income.sex.data.clean) + stat_smooth(method = "lm", se = FALSE, fullrange = TRUE)

plot.complex <- qplot(x = tot.incarc, y = income, 
                      color = sex, data = income.sex.data.clean) + 
  geom_abline(aes(intercept = intercepts, 
                  slope = slopes, 
                  color = sex), data = income.sex.incarc.slopes)

grid.arrange.incarc <- grid.arrange(plot.interact, plot.complex, ncol = 2)
grid.arrange.incarc
```

Using an anova test, we confirmed the above findings, that the tot.incarc-specific interaction intercept does not capture significantly more variation in income than the non-interaction term model at a significance level of .05, with a P-value of .5179.

```{r, echo = FALSE}
anova.incarc <- anova(update(income.sex.incarc.lm.interact, . ~ . - tot.incarc:sex), income.sex.incarc.lm.interact)
anova.incarc
```


```{r, echo = FALSE}
income.sex.bio.children <- income.sex.data.clean %>% 
  group_by(bio.children.2007) %>% 
  summarize(num.obs = n(), mean.male.income = round(mean(income[sex == 'Male']), 2), 
            mean.female.income = round(mean(income[sex == 'Female']), 2), 
            income.gap = round(mean(income[sex == 'Male']) -
              mean(income[sex == 'Female']), 2))

kable.bio.children <- income.sex.bio.children %>% 
  kable(format = 'markdown', digits = 2)
```

After looking at **tot.incarc**, we then wanted to explore how **bio.children.2007** affects the income gap between men and women. We found that the income gap was greatest for the people reported having 4 children, with a gap of $`r income.sex.bio.children$income.gap[5]`0. We also see that for those who reported having 5 or 6 children, women actually earned more than men, with the income gap of $`r abs(income.sex.bio.children$income.gap[6])` for 5 children. We definitely found it surprising that women with more children earned more then men. This can most likely be attributed to the small sample size of `r income.sex.bio.children$num.obs[6]` for 5 children and `r income.sex.bio.children$num.obs[7]` for 6 children. Further statistical analysis is needed.

```{r, echo = FALSE}
kable.bio.children
```


```{r, echo = FALSE}
bio.children.subset <- filter(income.sex.data.clean, (bio.children.2007 < 5)) #removed people with 5 and 6 children because sample size was too low (under 30)

bio.children.income.gap <- bio.children.subset %>% 
  group_by(bio.children.2007) %>% 
  summarize(income.gap = round(mean(income[sex == 'Male']) -
              mean(income[sex == 'Female']), 2),
            lower = t.test(income ~ sex)$conf.int[1],
            upper = t.test(income ~ sex)$conf.int[2],
            is.significant = as.numeric(t.test(income ~ sex)$p.value < 0.05))

bio.children.plot <- ggplot(data = bio.children.income.gap, aes(x = bio.children.2007, y = income.gap, fill = is.significant)) +
  geom_bar(stat = 'identity') +
  xlab('Number of Biological Children (2007)') +
  ylab('Income Gap ($)') +
  ggtitle('Income gap between men and women, by number of biological children') +
  guides(fill = FALSE) +
  geom_errorbar(aes(ymax = upper, ymin = lower), width = 0.1, size = 1) +
  theme(text = element_text(size = 12))
```

To confirm that our observations above are statistically significant, we then decided to create a bar graph that incorporated the results of a t.test() on **income** and **sex** grouped by **bio.children.2007**. In order to complete the test successfully, we had to remove those that reported 5 or 6 children (6 total observations) due to small sample size. The bar graph includes error bars derived from the t.test() confidence intervals. The bars are color coded to indicate significance at the .05 level. 

From the bar graph we concluded that there is a significant difference in income between men and women across all numbers of children reported because the error bars do not overlap 0. We were not surprised to find that the smallest income gap seen in this graph is for those who reported having no children. While it isn't surprising that the income gap for 4 children is the largest depicted, further analysis is needed to confirm significance as the number of observations for that group was only `r income.sex.bio.children$num.obs[5]`.

```{r, echo = FALSE}
bio.children.plot
```

We then created a simple regression model between **income**, **sex**, **bio.children.2007**. From the output below we found that number of children does have a significant impact on income at the .05 significance level. 

```{r, echo = FALSE}
income.sex.bio.child.lm <- lm(income ~ sex + bio.children.2007, data = income.sex.data.clean)
bio.child.kable <- kable(coef(summary(income.sex.bio.child.lm)), digits = c(0, 0, 2, 4))
bio.child.kable
```
```{r, echo = FALSE}
income.sex.bio.child.lm.interact <- update(income.sex.bio.child.lm, . ~ . + bio.children.2007*sex)
bio.child.kable.2 <- kable(coef(summary(income.sex.bio.child.lm.interact)), digits = c(0, 0, 2, 4))
```

To further explore the impact of **bio.children.2007** on income gap, we updated our regression model to include an interaction term between **sex** and **bio.children.2007**. We interpreted these results as such: The income gap between men and women increases by $`r round(abs(income.sex.bio.child.lm.interact$coef[4]), 2)` for each additional child reported.

```{r, echo = FALSE}
bio.child.kable.2
```


Using an anova test, we confirmed that the bio.children-specific intercept captures significantly more variation in income than the single intercept model at a significance level of .05, with a P-value of .007234.

```{r, echo = FALSE}
anova.child <- anova(update(income.sex.bio.child.lm.interact, . ~ . - bio.children.2007:sex), income.sex.bio.child.lm.interact)
anova.child
```

We then used the plot() function to produce diagnostic plots for the **income**, **sex**, and **bio.children.2007** regression model with the bio.children and sex interaction term.

***1. Residuals vs. Fitted:*** The plot looks almost linear, with a horizontal red line. The slight downward slope can possibly be attributed to the topcoded income values in our data set. 

***2. Normal Q-Q:*** The data looks relatively normally distributed, with a heavy upper tail that again can mostly be attributed to topcoded income values in our data set.

***3. Scale-Location:*** There is a slight upward trend of the red line in this plot, which could represent increasing variance.

***4. Residuals vs. Leverage:*** There are no obvious outliers. 

```{r, echo = FALSE}
par(mfrow = c(2,2), cex = 1)
child.plot <- plot(income.sex.bio.child.lm.interact)
child.plot
```

```{r, echo = FALSE}
mom.age.cor <- cor.test(income.sex.data.clean$mom.age.at.birth, income.sex.data.clean$income)

hh.cor <- cor.test(income.sex.data.clean$house.net.worth, income.sex.data.clean$income)

debt.cor <- cor.test(income.sex.data.clean$debt.at.20, income.sex.data.clean$income)
```

The remainder of our variables were either continuous or had such a large spread that it was easier to interpret their relationship with income through scatter plots.
Based on the plots below, we can say that none of the three variables, **mom.age.at.birth**, **house.net.worth**, or **debt.at.20** have a strong linear correlation with income. **mom.age.at.birth** correlation coefficient is `r round(mom.age.cor$estimate, 2)`, **house.net.worth** correlation coefficient is `r round(hh.cor$estimate, 2)`, and **debt.at.20** correlation coefficient is `r round(debt.cor$estimate, 2)`. However we can see that in each plot, average male income is higher than average female income. These scatter plots are not tests of significance, but rather observations.  

```{r, echo = FALSE}
scatter.mom.age <- ggplot(income.sex.data.clean, 
       aes(x=mom.age.at.birth, y=income, color=sex)) + 
  geom_point() + 
  geom_smooth(method = "lm") + 
  ylab("Income") +
  xlab("Mom's Age at Birth (Years)") + 
  ggtitle("Mom's Age at Birth and Income")  + 
  facet_grid(. ~ sex) +
  guides(fill = FALSE)


scatter.mom.age

scatter.house.net <- ggplot(income.sex.data.clean, 
       aes(x=house.net.worth, y=income, color=sex)) + 
  geom_point() + 
  geom_smooth(method = "lm") +
  ylab("Income") +
  xlab("Household Net Worth") + 
  ggtitle("Household Net Worth and Income")  + 
  facet_grid(. ~ sex) +
  guides(fill = FALSE)

scatter.house.net

scatter.debt <- ggplot(income.sex.data.clean, 
       aes(x=debt.at.20, y=income, color=sex)) + 
  geom_point() + 
  geom_smooth(method = "lm") +
  ylab("Income") + 
  xlab("Debt at Age 20") + 
  ggtitle("Debt at Age 20 and Income")  + 
  facet_grid(. ~ sex) +
  guides(fill = FALSE)

scatter.debt
```

### 3. Conclusion
After exploring the variables in depth, we then built a final regression model that depicts the relationship between our significant variables and income gap between men and women. The only variable we removed from our final regression model was **phy.emo.issue** because it was neither significant in our original regression model nor in our original interaction terms model. 

```{r, echo = FALSE}
final.income.sex.lm <- update(income.sex.lm, . ~ . - phy.emo.issue)
final.kable <- kable(coef(summary(final.income.sex.lm)), digits = c(0, 0, 2, 4))
```


The below regression model includes topcoded income values. We can interpret these results as such: the income gap between our baseline male and female variables is $`r round(abs(final.income.sex.lm$coef[2]), 2)`. You can then add additional variable coefficients onto this model to get an estimate for a more specific individual.

```{r, echo = FALSE}
final.kable
```

The diagnostic plots for this regression model are:

***1. Residuals vs. Fitted:*** The plot's horizontal red line dips in the middle and then slopes upward, but not significantly enough to be worrisome that the model is inaccurate.

***2. Normal Q-Q:*** The data looks relatively normally distributed, with a heavy upper tail that can mostly be attributed to topcoded income values in our data set.

***3. Scale-Location:*** There is a strong upward trend of the red line in this plot, which could represent increasing variance.

***4. Residuals vs. Leverage:*** There are no obvious outliers. 

```{r, echo = FALSE}
par(mfrow = c(2,2), cex = 1)
final.plot <- plot(final.income.sex.lm) #this is plot of final model with top-coding included
final.plot
```

```{r, echo = FALSE}
subset.final.income.lm <- lm(income ~ + sex + race + tot.incarc + mom.age.at.birth + house.net.worth + urban.rural + bio.children.2007 + high.degree.earned + debt.at.20, data = income.subset)
subet.final.kable <- kable(coef(summary(subset.final.income.lm)), digits = c(0, 0, 2, 4))
```

We were curious to see how eliminating topcoded income values from the data set would impact the model. As you can see, the income gap between our baseline male and female variables decreased to $`r round(abs(subset.final.income.lm$coef[2]), 2)`. Once again, you can add additional variable coefficients onto this model to get an estimate for a more specific individual.

We also see that **mom.age.at.birth**  and **urban.ruralRural** are no longer significant variables at the .05 significance level when topcoded income values are eliminated.

```{r, echo = FALSE}
subet.final.kable
```

The diagnostic plots for this regression model are:

***1. Residuals vs. Fitted:*** The plot's horizontal red line is nearly perfectly linear, as compared to the upward sloping line in the plot with topcoded values included.

***2. Normal Q-Q:*** The data looks relatively normally distributed, with a slightly less heavy upper tail that can mostly be attributed to the removal of topcoded income values from our data set.

***3. Scale-Location:*** There is still a strong upward trend of the red line in this plot, which could represent increasing variance.

***4. Residuals vs. Leverage:*** There are no obvious outliers. 

```{r, echo = FALSE}
par(mfrow = c(2,2), cex = 1)
subset.final.plot <- plot(subset.final.income.lm) #this is plot of final model with top-coding removed
subset.final.plot
```

```{r, echo = FALSE}
final.interact.lm <- update(final.income.sex.lm, . ~ . + sex*race + sex*bio.children.2007 + sex*high.degree.earned)
final.interact.kable <- kable(coef(summary(final.interact.lm)), digits = c(0, 0, 2, 4))
```

Based on our data exploration, we want to further explore the significant interaction terms **sex** * **race**, **sex** * **bio.children.2007**, and **sex** * **high.degree.earned** against the full final regression model we created above. 

We interpreted these results as such: The income gap between "Black" men and "Black" women is $`r round(final.interact.lm$coef[22], 2)`0 less than the income gap between our baseline "Other" race men and "Other" women. 

We were also surprised to see that the interaction between **sex** and **high.degree.earned** does not have a statistically significant impact on income, where as whether or not you have a degree in general, does have a significant impact on income at the .05 significance level. 

```{r, echo = FALSE}
final.interact.kable
```

Using an anova test, we confirmed that the interaction terms we included in the regression interaction model above capture significantly more variation in income than the single intercept model at a significance level of .05. The interaction between **sex** and **race** was significant, with a p-value of .000326. The interaction between **sex** and **bio.children.2007** was significant, with a p-value of .002321. The interaction between **sex** and **high.degree.earned** was significant, with a p-value of .002141. This last conclusion was especially surprising considering the results of our interaction regression model showed that there was no significant impact on income when looking at the interaction between **sex** and **high.degree.earned**. 

```{r, echo = FALSE}
anova.race.final.interact <- anova(update(final.interact.lm, . ~ . - sex:race), final.interact.lm)
anova.race.final.interact
```

```{r, echo = FALSE}
anova.child.2007 <- anova(update(final.interact.lm, . ~ . - sex:bio.children.2007), final.interact.lm)
anova.child.2007
```

```{r, echo = FALSE}
anova.degree.final <- anova(update(final.interact.lm, . ~ . - sex:high.degree.earned), final.interact.lm)
anova.degree.final
```

We then used the plot() function to produce diagnostic plots for the full regression interaction model with the **sex** * **race**, **sex** * **bio.children.2007**, and **sex** * **high.degree.earned** interaction terms.

***1. Residuals vs. Fitted:*** The plot has a horizontal red line with a dip in the middle. While this is not a drastic parabola, if we were to explore further, it might be useful to square our income values to account for this dip. 

***2. Normal Q-Q:*** The data looks relatively normally distributed, with a heavy upper tail that again can mostly be attributed to topcoded income values in our data set.

***3. Scale-Location:*** There is a strong upward trend of the red line in this plot, which could represent increasing variance.

***4. Residuals vs. Leverage:*** There are no obvious outliers. 

```{r, echo = FALSE}
par(mfrow = c(2,2), cex = 1)
final.interact.plot <- plot(final.interact.lm)
final.interact.plot
```

```{r, echo = FALSE}
subset.final.income.interact.lm <- update(subset.final.income.lm, . ~ . + sex*race + sex*bio.children.2007 + sex*high.degree.earned)
subset.final.interact.kable <- kable(coef(summary(subset.final.income.interact.lm)), digits = c(0, 0, 2, 4))
```

We were curious to see how eliminating topcoded income values from the data set would impact our interaction regression model. As you can see below, income gap between "Black" men and "Black" women is now $`r round(subset.final.income.interact.lm$coef[22], 2)` less than the income gap between our baseline "Other" race men and "Other" women. This is a decrease in income gap of $`r round(final.interact.lm$coef[22], 2) - round(subset.final.income.interact.lm$coef[22], 2)` attributed to the removal of topcoded income.  Once again, you can add additional variable coefficients onto this model to get an estimate for a more specific individual. 

As with the topcoded and non-topcoded regression models above, we see that in this interaction regression model, **mom.age.at.birth**  and **urban.ruralRural** are no longer significant variables at the .05 significance level when topcoded income values are eliminated.

```{r, echo = FALSE}
subset.final.interact.kable
```

Using an anova test, we confirmed that the interaction terms we included in the non-topcoded regression interaction model above capture significantly more variation in income than the single intercept model at a significance level of .05. The interaction between **sex** and **race** was even more highly significant than with topcoded values included, with a p-value of .00016. The interaction between **sex** and **bio.children.2007** was also more significant, with a p-value of .0017. Unlike in the model with topcoded values included, in this interaction regression model, the interaction between **sex** and **high.degree.earned** was NOT significant at the .05 level, with a p-value of 0.15. This falls more in line with what we were seeing in our interaction regression models above, where there was no significant impact on income based on the interaction between sex and degree.

```{r, echo = FALSE}
subset.anova.race.final.interact <- anova(update(subset.final.income.interact.lm, . ~ . - sex:race), subset.final.income.interact.lm) 
subset.anova.race.final.interact
```

```{r, echo = FALSE}
subset.anova.child.final.interact <- anova(update(subset.final.income.interact.lm, . ~ . - sex:bio.children.2007), subset.final.income.interact.lm) 
subset.anova.child.final.interact
```

```{r, echo = FALSE}
subset.anova.edu.final.interact <- anova(update(subset.final.income.interact.lm, . ~ . - sex:high.degree.earned), subset.final.income.interact.lm) 
subset.anova.edu.final.interact
```

We then used the plot() function to produce diagnostic plots for the subset full regression interaction model with the **sex** * **race**, **sex** * **bio.children.2007**, and **sex** * **high.degree.earned** interaction terms.

***1. Residuals vs. Fitted:*** The plot looks nearly linear, with an almost horizontal red line. Removal of the topcoded values remedied the irregularities in this line.

***2. Normal Q-Q:*** The data looks relatively normally distributed, with a less heavy upper tail that can mostly be attributed to the removal of topcoded income values from our data set.

***3. Scale-Location:*** The presence of an upward sloping line in both this plot and the plot with topcoded values means that the increased variance cannot be attributed to the topcoded values as previously hypothesized.

***4. Residuals vs. Leverage:*** There are no obvious outliers in this data set. 


```{r, echo = FALSE}
par(mfrow = c(2,2), cex = 1)
subset.final.plot <- plot(subset.final.income.interact.lm)
subset.final.plot
```

### Discussion
Based on our findings, we can conclude with a high degree of certainty that average income for men is greater than average income for women. 
We also correctly predicted that race, incarceration, and number of children would have a significant impact on income. Race and number of children also had a significant impact on the income gap between men and women. We were, however, surprised to find that while frequency of incarceration had an impact on income, it did not have a significant impact on income gap between men and women. 

Based on analysis of our regression models that included topcoded income values versus those that removed topcoded income values, we believe that using a data set where the topcoded values are removed will make for a more successful predictor of income. We came to this conclusion because the diagnostic plot showed a more normally distributed model, with a nearly horizontal Residual vs. Fitted line. Also, the data set with topcoded values removed was the only set where our anova test of **sex** and **high.degree.earned** reflected the insignificance that we saw in our regression models.

When we first started exploring the data, we hypothesized that level of education would be a statistically significant predictor of income gap between men and women. We found this not to be true, especially not in the data set where we removed topcoded income values. 

We also hypothesized that variables such as **debt.at.20** and **house.net.worth** would have stronger linear correlations to income than they actually did. We had believed that growing up in a wealthier household would have resulted in higher income as an adult, and that high levels of debt would have resulted in lower income as an adult. Had we dug deeper into those variables, we could have tested removing topcoded values to determine if that would strengthen or weaken linear correlations with income. 

We had hypothesized that the variable **urban.rural** would have a more significant impact on income and income gap between men and women. Through our analysis we found that there was no significant difference in income or in income gap between people who grew up in an urban versus a rural environment. 

After an indepth analysis of our 11 variables, we feel confident in our report. The conclusions we drew make sense intuitively, and we have data to back them up. The one area we still feel unsure about is the **high.degree.earned** variable. We would have thought degree would have a larger impact on income gap. We coded 1621 rows in **high.degree.earned** as "Missing," which ended up being the one degree factor that was statistically significant when it came to impact on income. Had we known a little bit more about these missing values, we could have recoded them differently and drawn different, or more meaningful, conclusions. 

We also feel confident that we have considered potential confounding variables in our model. All of these variables are inter-related, so it's difficult to fully isolate just one and predict its impact. Having said this, we purposefully selected a diverse set of variables so as to be able to test how a variety of factors could impact income and income gap. For example, we chose to use **high.degree.earned** as a proxy for education, and did not add other education variables, such as GPA or SAT score, to our model. This allowed us room to incorporate other factors such as mother's age when giving birth, or debt at age 20. 

Before we would feel comfortable presenting these findings to policy makers, we'd want to have a greater understanding of the NLSY 1997 data, including how valid skips were determined, and what other questions were asked for which no data was shared.



